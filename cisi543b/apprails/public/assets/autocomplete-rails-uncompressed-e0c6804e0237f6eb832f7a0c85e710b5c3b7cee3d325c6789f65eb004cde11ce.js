!function(s){s.fn.railsAutocomplete=function(t){var e=function(){this.railsAutoCompleter||(this.railsAutoCompleter=new s.railsAutocomplete(this))};return s.fn.on===undefined?this.live("focus",e):t?s(document).on("focus",t,e):void 0},s.railsAutocomplete=function(t){var e=t;this.init(e)},s.railsAutocomplete.options={showNoMatches:!0,noMatchesLabel:"no existing match"},s.railsAutocomplete.fn=s.railsAutocomplete.prototype={railsAutocomplete:"0.0.1"},s.railsAutocomplete.fn.extend=s.railsAutocomplete.extend=s.extend,s.railsAutocomplete.fn.extend({init:function(u){function c(t){return t.split(u.delimiter)}function r(t){return c(t).pop().replace(/^\s+/,"")}u.delimiter=s(u).attr("data-delimiter")||null,u.min_length=s(u).attr("data-min-length")||s(u).attr("min-length")||2,u.append_to=s(u).attr("data-append-to")||null,u.autoFocus=s(u).attr("data-auto-focus")||!1,s(u).autocomplete({appendTo:u.append_to,autoFocus:u.autoFocus,delay:s(u).attr("delay")||0,source:function(t,e){var a=this.element[0],i={term:r(t.term)};s(u).attr("data-autocomplete-fields")&&s.each(s.parseJSON(s(u).attr("data-autocomplete-fields")),function(t,e){i[t]=s(e).val()}),s.getJSON(s(u).attr("data-autocomplete"),i,function(t){var i={};s.extend(i,s.railsAutocomplete.options),s.each(i,function(t,e){if(i.hasOwnProperty(t)){var a=s(u).attr("data-"+t);i[t]=a||e}}),0==t.length&&0<=s.inArray(i.showNoMatches,[!0,"true"])&&((t=[])[0]={id:"",label:i.noMatchesLabel}),s(t).each(function(t,e){var a={};a[e.id]=e,s(u).data(a)}),e.apply(null,arguments),s(a).trigger("railsAutocomplete.source",arguments)})},change:function(t,e){if(s(this).is("[data-id-element]")&&""!==s(s(this).attr("data-id-element")).val()&&(s(s(this).attr("data-id-element")).val(e.item?e.item.id:"").trigger("change"),s(this).attr("data-update-elements"))){var a=s.parseJSON(s(this).attr("data-update-elements")),i=e.item?s(this).data(e.item.id.toString()):{};if(a&&""===s(a.id).val())return;for(var r in a){var n=s(a[r]);n.is(":checkbox")?null!=i[r]&&n.prop("checked",i[r]):n.val(e.item?i[r]:"").trigger("change")}}},search:function(){if(r(this.value).length<u.min_length)return!1},focus:function(){return!1},select:function(t,e){if(e.item.value=e.item.value.toString(),-1!=e.item.value.toLowerCase().indexOf("no match")||-1!=e.item.value.toLowerCase().indexOf("too many results"))return s(this).trigger("railsAutocomplete.noMatch",e),!1;var a=c(this.value);if(a.pop(),a.push(e.item.value),null!=u.delimiter)a.push(""),this.value=a.join(u.delimiter);else if(this.value=a.join(""),s(this).attr("data-id-element")&&s(s(this).attr("data-id-element")).val(e.item.id).trigger("change"),s(this).attr("data-update-elements")){var i=e.item,r=-1!=e.item.value.indexOf("Create New"),n=s.parseJSON(s(this).attr("data-update-elements"));for(var o in n)"checkbox"===s(n[o]).attr("type")?!0===i[o]||1===i[o]?s(n[o]).attr("checked","checked"):s(n[o]).removeAttr("checked"):r&&i[o]&&-1==i[o].indexOf("Create New")||!r?s(n[o]).val(i[o]).trigger("change"):s(n[o]).val("").trigger("change")}var l=this.value;return s(this).bind("keyup.clearId",function(){s.trim(s(this).val())!=s.trim(l)&&(s(s(this).attr("data-id-element")).val("").trigger("change"),s(this).unbind("keyup.clearId"))}),s(u).trigger("railsAutocomplete.select",e),!1}}),s(u).trigger("railsAutocomplete.init")}}),s(document).ready(function(){s("input[data-autocomplete]").railsAutocomplete("input[data-autocomplete]")})}(jQuery);